<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>blogs</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui;
  background:#000;
  color:#fff;
}

/* HEADER */
.header{
  padding:16px;
  font-size:18px;
  font-weight:600;
  background:#000;
}

/* LIST VIEW */
#listView{display:block}
.card{
  background:#16161d;
  margin:14px;
  border-radius:16px;
  overflow:hidden;
  cursor:pointer;
}
.card img{
  width:100%;
  height:180px;
  object-fit:cover;
}
.card-title{
  padding:14px;
  font-size:16px;
  font-weight:600;
}

/* READ VIEW */
#readView{display:none}
.back{
  padding:14px;
  cursor:pointer;
  color:#6d4cff;
}
.blog-title{
  padding:0 14px 10px;
  font-size:18px;
  font-weight:700;
}

/* üî• BLACK BLOG VIEW */
.blog-content{
  background:#000;
  color:#fff;
  margin:14px;
  padding:14px;
  border-radius:16px;
}
.blog-content img{
  width:100%;
  margin:12px 0;
  border-radius:14px;
}
.blog-content iframe{
  width:100%;
  height:220px;
  margin:12px 0;
  border-radius:14px;
}
</style>
</head>

<body>

<div class="header" id="headerTitle"></div>

<!-- BLOG LIST -->
<div id="listView">
  <div id="blogList">Please wait....</div>
</div>

<!-- BLOG READ -->
<div id="readView">
  <div class="back" onclick="backToList()"> </div>
  <div class="blog-title" id="readTitle"></div>
  <div class="blog-content" id="readContent"></div>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyDuSRmCqggE2eS6l3nHciy4cNvrwyw-l_I",
  authDomain:"cirithe.firebaseapp.com",
  projectId:"cirithe"
});
const db = firebase.firestore();

/* LOAD BLOG LIST */
db.collection("blogs").orderBy("time","desc")
.onSnapshot(s=>{
  blogList.innerHTML="";
  if(s.empty){
    blogList.innerHTML="<div style='padding:14px'>‡§ï‡•ã‡§à ‡§¨‡•ç‡§≤‡•â‡§ó ‡§®‡§π‡•Ä‡§Ç</div>";
  }
  s.forEach(d=>{
    const b=d.data();
    blogList.innerHTML+=`
      <div class="card" onclick="openBlog('${d.id}')">
        ${b.cover?`<img src="${b.cover}">`:``}
        <div class="card-title">${b.title}</div>
      </div>
    `;
  });
});

/* OPEN BLOG */
function openBlog(id){
  listView.style.display="none";
  readView.style.display="block";
  headerTitle.innerText="";

  db.collection("blogs").doc(id).get().then(doc=>{
    if(!doc.exists){
      readTitle.innerText="Blog ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ";
      readContent.innerHTML="";
      return;
    }
    const b=doc.data();
    readTitle.innerText=b.title;
    readContent.innerHTML=b.html;
  });
}

/* BACK */
function backToList(){
  readView.style.display="none";
  listView.style.display="block";
  headerTitle.innerText="Blogs";
}
</script>

</body>
</html>
